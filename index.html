<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bionic Hand Project</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background: #fff;
      border-radius: 8px;
    }
    h1, h2 {
      color: #333;
    }
    pre {
      background: #eee;
      padding: 1rem;
      overflow-x: auto;
      position: relative;
    }
    button.copy {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #007bff;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }
    .comment-section {
      margin-top: 2rem;
    }
    .comment {
      border: 1px solid #ccc;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 5px;
      background: #fafafa;
    }
    .reply {
      margin-left: 2rem;
      background: #f1f1f1;
    }
    img, video {
      max-width: 100%;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bionic Hand Project</h1>
    <p>ì´ í”„ë¡œì íŠ¸ëŠ” ê·¼ì „ë„(EMG) ì„¼ì„œë¥¼ ì´ìš©í•˜ì—¬ ì†ê°€ë½(ì—„ì§€)ì˜ ì›€ì§ì„ì„ ì œì–´í•˜ëŠ” ì˜ìˆ˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì•„ë‘ì´ë…¸ì™€ MYOWARE 2.0 ì„¼ì„œë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ê·¼ìœ¡ ì‹ í˜¸ë¥¼ ê°ì§€í•˜ê³ , ê·¸ì— ë”°ë¼ ì„œë³´ëª¨í„°ë¥¼ ì œì–´í•˜ì—¬ ì‹¤ì œ ì†ê°€ë½ ì›€ì§ì„ì²˜ëŸ¼ ì‘ë™í•©ë‹ˆë‹¤.</p>
    <p><a href="https://gamma.app/docs/EMG--fxp1jqdan0hg2tt" target="_blank">ğŸ“ í”„ë¡œì íŠ¸ ë°œí‘œ PPT ë³´ê¸°</a></p>

    <h2>ì•„ë‘ì´ë…¸ ì½”ë“œ</h2>
    <pre><button class="copy" onclick="copyCode()">Copy</button><code id="code">
#include <Servo.h>

Servo myServo;

const int sensorPin = A0;
const int averageSampleSize = 10;
int sensorReadings[averageSampleSize];
int index = 0;
long total = 0;

long threshold = 0;
const int hysteresis = 5;
const int thresholdOffset = 15;

bool isActivated = false;
int lastServoPosition = 0;
unsigned long lastToggleTime = 0;
const unsigned long debounceTime = 500;

void setup() {
  myServo.attach(9);
  Serial.begin(9600);
  myServo.write(0);
  delay(1000);

  for (int i = 0; i < averageSampleSize; i++) {
    sensorReadings[i] = 0;
  }

  Serial.println("Pre-filling readings buffer...");
  for (int i = 0; i < averageSampleSize; i++) {
    int val = analogRead(sensorPin);
    sensorReadings[i] = val;
    total += val;
    delay(20);
  }

  Serial.println("CALIBRATION: Relax your muscle for 5 seconds...");
  long sum = 0;
  int maxVal = 0;
  int minVal = 1023;
  const int calibrationSamples = 100;

  for (int i = 0; i < calibrationSamples; i++) {
    int val = analogRead(sensorPin);
    sum += val;
    maxVal = max(maxVal, val);
    minVal = min(minVal, val);
    if (i % 10 == 0) {
      Serial.print("Sample ");
      Serial.print(i);
      Serial.print(": ");
      Serial.println(val);
    }
    delay(50);
  }

  long baseline = sum / calibrationSamples;
  int variance = maxVal - minVal;
  threshold = baseline + thresholdOffset;

  Serial.println("\n--- Calibration Results ---");
  Serial.print("Min value: "); Serial.println(minVal);
  Serial.print("Max value: "); Serial.println(maxVal);
  Serial.print("Baseline: "); Serial.println(baseline);
  Serial.print("Variance: "); Serial.println(variance);
  Serial.print("Threshold set to: "); Serial.println(threshold);
  Serial.println("-------------------------");
  Serial.println("Now flex your muscle to test!");
}

void loop() {
  int newValue = analogRead(sensorPin);
  total -= sensorReadings[index];
  sensorReadings[index] = newValue;
  total += sensorReadings[index];
  index = (index + 1) % averageSampleSize;

  int avgValue = total / averageSampleSize;

  Serial.print("Raw: "); Serial.print(newValue);
  Serial.print(" | Avg: "); Serial.print(avgValue);
  Serial.print(" | Threshold: "); Serial.print(threshold);

  unsigned long currentTime = millis();
  if (avgValue > threshold && !isActivated && (currentTime - lastToggleTime > debounceTime)) {
    toggleServo();
    isActivated = true;
    lastToggleTime = currentTime;
    Serial.print(" | ACTIVATED!");
  }

  if (avgValue < (threshold - hysteresis)) {
    isActivated = false;
  }

  Serial.println();
  delay(50);
}

void toggleServo() {
  int target = (lastServoPosition == 0) ? 180 : 0;
  int step = (target > lastServoPosition) ? 5 : -5;
  for (int pos = lastServoPosition; pos != target; pos += step) {
    myServo.write(pos);
    delay(15);
  }
  myServo.write(target);
  lastServoPosition = target;
  Serial.print("Servo toggled to: ");
  Serial.println(target);
}</code></pre>

    <div class="comment-section">
      <h2>ë¦¬ë·° ë° ëŒ“ê¸€</h2>
      <div id="comments"></div>
      <textarea id="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br/>
      <input type="text" id="media-url" placeholder="ì‚¬ì§„ ë˜ëŠ” ë™ì˜ìƒ URL (ì„ íƒ)" /><br/>
      <button onclick="addComment()">ëŒ“ê¸€ ì‘ì„±</button>
    </div>
  </div>

  <script>
    function copyCode() {
      const code = document.getElementById("code").innerText;
      navigator.clipboard.writeText(code).then(() => {
        alert("ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
      });
    }

    let commentId = 0;
    function addComment(parentId = null) {
      const input = document.getElementById('comment-input');
      const media = document.getElementById('media-url');
      const commentsDiv = document.getElementById('comments');
      const text = input.value.trim();
      const mediaLink = media.value.trim();
      if (!text) return;

      const div = document.createElement('div');
      div.className = parentId ? 'comment reply' : 'comment';
      div.id = `comment-${commentId++}`;

      div.innerHTML = `<p>${text}</p>`;
      if (mediaLink) {
        if (mediaLink.endsWith('.mp4')) {
          div.innerHTML += `<video src="${mediaLink}" controls></video>`;
        } else {
          div.innerHTML += `<img src="${mediaLink}" />`;
        }
      }
      div.innerHTML += `<button onclick="replyTo('${div.id}')">ë‹µê¸€</button>
                        <button onclick="deleteComment('${div.id}')">ì‚­ì œ</button>`;
      if (parentId) {
        document.getElementById(parentId).appendChild(div);
      } else {
        commentsDiv.appendChild(div);
      }
      input.value = '';
      media.value = '';
    }

    function replyTo(id) {
      const text = prompt("ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (text) {
        const replyDiv = document.createElement('div');
        replyDiv.className = 'comment reply';
        replyDiv.innerHTML = `<p>${text}</p>
                              <button onclick="deleteComment(this.parentNode.id)">ì‚­ì œ</button>`;
        replyDiv.id = `comment-${commentId++}`;
        document.getElementById(id).appendChild(replyDiv);
      }
    }

    function deleteComment(id) {
      const comment = document.getElementById(id);
      if (comment) comment.remove();
    }
  </script>
</body>
</html>
