<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bionic Hand Project</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1, h2 {
      color: #2c3e50;
    }
    pre {
      background-color: #f4f4f4;
      padding: 15px;
      overflow-x: auto;
      border-radius: 5px;
    }
    code {
      font-family: Consolas, monospace;
    }
    .comment-box, .reply-box {
      margin-top: 20px;
    }
    .comment {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }
    .reply {
      margin-left: 20px;
      border-left: 2px solid #ddd;
      padding-left: 10px;
    }
    .media {
      margin-top: 10px;
    }
    textarea, input[type="file"] {
      width: 100%;
      margin-bottom: 10px;
    }
    button {
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Bionic Hand 프로젝트</h1>
  <p>MYOWARE 2.0 근전도 센서를 활용한 엄지 손가락 제어 시스템</p>
  <p><strong>프로젝트 발표 자료:</strong> <a href="https://gamma.app/docs/EMG--fxp1jqdan0hg2tt" target="_blank">Gamma PPT 보기</a></p>

  <h2>아두이노 코드</h2>
  <pre><code>#include &lt;Servo.h&gt;

Servo myServo;

const int sensorPin = A0;
const int averageSampleSize = 10;
int sensorReadings[averageSampleSize];
int index = 0;
long total = 0;

long threshold = 0; // Will be set automatically
const int hysteresis = 5;
const int thresholdOffset = 15;

bool isActivated = false;
int lastServoPosition = 0;
unsigned long lastToggleTime = 0;
const unsigned long debounceTime = 500;

void setup() {
  myServo.attach(9);
  Serial.begin(9600);
  myServo.write(0);
  delay(1000);
  for (int i = 0; i &lt; averageSampleSize; i++) {
    sensorReadings[i] = 0;
  }
  Serial.println("Pre-filling readings buffer...");
  for (int i = 0; i &lt; averageSampleSize; i++) {
    int val = analogRead(sensorPin);
    sensorReadings[i] = val;
    total += val;
    delay(20);
  }
  Serial.println("CALIBRATION: Relax your muscle for 5 seconds...");
  long sum = 0;
  int maxVal = 0;
  int minVal = 1023;
  const int calibrationSamples = 100;
  for (int i = 0; i &lt; calibrationSamples; i++) {
    int val = analogRead(sensorPin);
    sum += val;
    maxVal = max(maxVal, val);
    minVal = min(minVal, val);
    if (i % 10 == 0) {
      Serial.print("Sample ");
      Serial.print(i);
      Serial.print(": ");
      Serial.println(val);
    }
    delay(50);
  }
  long baseline = sum / calibrationSamples;
  int variance = maxVal - minVal;
  threshold = baseline + thresholdOffset;
  Serial.println("\n--- Calibration Results ---");
  Serial.print("Min value: ");
  Serial.println(minVal);
  Serial.print("Max value: ");
  Serial.println(maxVal);
  Serial.print("Baseline: ");
  Serial.println(baseline);
  Serial.print("Variance: ");
  Serial.println(variance);
  Serial.print("Threshold set to: ");
  Serial.println(threshold);
  Serial.println("-------------------------");
  Serial.println("Now flex your muscle to test!");
}

void loop() {
  int newValue = analogRead(sensorPin);
  total -= sensorReadings[index];
  sensorReadings[index] = newValue;
  total += sensorReadings[index];
  index = (index + 1) % averageSampleSize;
  int avgValue = total / averageSampleSize;
  Serial.print("Raw: ");
  Serial.print(newValue);
  Serial.print(" | Avg: ");
  Serial.print(avgValue);
  Serial.print(" | Threshold: ");
  Serial.print(threshold);
  unsigned long currentTime = millis();
  if (avgValue &gt; threshold &amp;&amp; !isActivated &amp;&amp; (currentTime - lastToggleTime &gt; debounceTime)) {
    toggleServo();
    isActivated = true;
    lastToggleTime = currentTime;
    Serial.print(" | ACTIVATED!");
  }
  if (avgValue &lt; (threshold - hysteresis)) {
    isActivated = false;
  }
  Serial.println();
  delay(50);
}

void toggleServo() {
  int target = (lastServoPosition == 0) ? 180 : 0;
  int step = (target &gt; lastServoPosition) ? 5 : -5;
  for (int pos = lastServoPosition; pos != target; pos += step) {
    myServo.write(pos);
    delay(15);
  }
  myServo.write(target);
  lastServoPosition = target;
  Serial.print("Servo toggled to: ");
  Serial.println(target);
}
</code></pre>

  <h2>리뷰 및 댓글</h2>
  <div class="comment-box">
    <textarea id="commentText" placeholder="댓글을 입력하세요..."></textarea>
    <input type="file" id="mediaInput" accept="image/*,video/*">
    <button onclick="addComment()">댓글 등록</button>
  </div>
  <div id="comments"></div>

  <script>
    let comments = [];

    function addComment() {
      const text = document.getElementById("commentText").value;
      const fileInput = document.getElementById("mediaInput");
      const file = fileInput.files[0];
      const id = Date.now();

      const reader = new FileReader();
      reader.onload = function(e) {
        const mediaUrl = e.target.result;
        comments.push({ id, text, mediaUrl, replies: [] });
        document.getElementById("commentText").value = "";
        fileInput.value = null;
        renderComments();
      };

      if (file) {
        reader.readAsDataURL(file);
      } else {
        comments.push({ id, text, mediaUrl: null, replies: [] });
        renderComments();
      }
    }

    function renderComments() {
      const container = document.getElementById("comments");
      container.innerHTML = "";
      comments.forEach(comment => {
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `<p>${comment.text}</p>` +
          (comment.mediaUrl ? `<div class='media'>${getMediaHTML(comment.mediaUrl)}</div>` : '') +
          `<div class='reply-box'>
            <textarea placeholder='답글을 입력하세요...' data-id='${comment.id}'></textarea>
            <button onclick='addReply(${comment.id})'>답글</button>
          </div>
          <button onclick='deleteComment(${comment.id})'>삭제</button>
          <div class='reply-area'>${renderReplies(comment.replies)}</div>`;
        container.appendChild(div);
      });
    }

    function getMediaHTML(url) {
      return url.includes("video") ? `<video controls width="250" src="${url}"></video>` : `<img src="${url}" width="250">`;
    }

    function renderReplies(replies) {
      return replies.map(reply => `<div class='reply'><p>${reply}</p></div>`).join('');
    }

    function addReply(commentId) {
      const textarea = document.querySelector(`textarea[data-id='${commentId}']`);
      const text = textarea.value;
      const comment = comments.find(c => c.id === commentId);
      if (comment && text) {
        comment.replies.push(text);
        textarea.value = "";
        renderComments();
      }
    }

    function deleteComment(id) {
      comments = comments.filter(c => c.id !== id);
      renderComments();
    }
  </script>
</body>
</html>
